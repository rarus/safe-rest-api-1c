<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" href="v8help://service_book/service_style"></link></head><body class="">
<h1 class="" style="font-size: 17.920000076293945px;">Справочник «Сервисы»</h1>
<p>Справочник «Сервисы» предназначен для ведения списка HTTP-сервисов и их настройки. </p>
<p>Каждый элемент справочника описывает настройки, применяемые к каждому конкретному сервису. </p>
<p>Такая возможность существенно облегчает администрирование и настройку сервисов в пользовательском режиме 1С:Предприятие. </p>
<p>Например, для одного сервиса можно включить только журналирование, для другого сервиса журналирование, контроль ключей идемпотентности и контроль конфликтов запросов, а для третьего можно отключить все механизмы учета и контроля, предоставив ему возможность работать в "свободном" режиме. </p>
<p>В случае необходимости, один из сервисов можно и вовсе отключить, сделав его недоступным для входящих запросов.</p>
<p>Наименование элемента справочника должно соответствовать свойству "Корневой URL" объекта метаданных HTTP-сервис в конфигурации. Для обеспечения выполнения этого требования заполнение поля "Имя сервиса" доступно только на основании списка HTTP-сервисов, описаннных в методанных конфигурации.</p>
<p>Перед записью элемента справочника выполняется проверка на наличие в конфигурации HTTP-сервиса с таким же значением свойства "Корневой URL", что задано в поле "Имя сервиса". Если соответствующий сервис в конфигурации не найден, записать такой элемент справочника не получится.</p>
<p>Поле "Имя сервиса" имеет служебное, техническое назначение. Для произвольного описания особенностей сервиса пользователю доступно поле "Описание" в форме элемента справочника "Сервисы".</p>
<p>При обработке входящего HTTP-запроса, настройки сервиса получаются по тому имени сервиса, которое извлекается из базового URL входящего запроса. </p>
<p><b>Пример корректной настройки имени сервиса:</b></p>
<blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;">
<p>Значение свойства "Корневой URL" сервиса в конфигурации - <b>"test-api"</b>;<br>Базовый URL входящего запроса - "https://localhost/idempotency/hs/<b>test-api</b>";<br>Имя сервиса, извлеченное из URL - <b>"test-api"</b>;<br>Наименование элемента справочника "Сервисы" - <b>"test-api"</b>.</p>

<p></p></blockquote>

<h2><span style="font-size: 15.680000305175781px; font-weight: bold;">Настройки сервиса</span></h2>
<p>Настройки сервиса расположены в форме элемента справочника в порядке подчинения родительским опциям. Родительские опции выше, подчиненные ниже.</p>
<p>Настройки каждого блока функционала описан на соответствующей вкладке формы: блок настроек журналирования - на вкладке  "Журнал входящих запросов", блок обеспечения идемпотентности и контроля конфликтов запросов - на вкладке "Контроль запросов".</p>
<p>При отключении родительской опции, подчиненные опции каскадно отключаются и становятся недоступными для использования. </p>
<p>Для каждого элемента справочника "Сервисы" доступны следующие настройки:</p>
<p> - <b>Используется</b>: Управляет доступностью сервиса для входящих HTTP-запросов. Если использование сервиса отключено, в ответ на входящие запросы к этому сервису клиент будет получать ошибку <b>503 Service Unavailable</b>;</p>
<p> - <b>Журналирование</b>: Включает запись ключевых параметров входящих HTTP-запросов в регистр сведений <a href="InformationRegister.кв_ЖурналВходящихHTTPЗапросов/Help">"Журнал входящих HTTP-запросов"</a>;</p>
<p> - <b>Дней хранения записей журналов</b>: Определяет время хранения записей регистров сведений <a href="InformationRegister.кв_ЖурналВходящихHTTPЗапросов/Help">"Журнал входящих HTTP-запросов"</a> и <a href="InformationRegister.кв_ЖурналКонфликтовHTTPЗапросов/Help">"Журнал конфликтов HTTP-запросов"</a> в днях с момента внесения записи в регистр. По истечении срока хранения записи удаляются из регистров регламентным заданием "Сокращение журналов входящих HTTP-запросов и конфликтов HTTP-запросов".</p>
<p> - <b>Контроль ключей</b>: Включает проверку идемпотентности операций с помощью заголовка Idempotency-Key во входящих HTTP-запросах. </p>
<blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;">
<p class="Important">Эта и последующие настройки распространяются на весь сервис в целом. Однако применимость их на уровне конкретного метода (ресурса) определяется разработчиком при внедрении в коде конфигурации с помощью булевых параметров <b>"ОбспечениеИдемпотентности"</b> и <b>"КонтрольКонфликтовЗапросов"</b>. Эти параметры передаются в метод формирования контекста входящего HTTP-запроса. Если в метод формирования контекста для входящего запроса по конкретному ресурсу эти параметры переданы со значением =<b> Истина</b>, тогда одноименные настройки сервиса будут применятся к обработчику этого запроса;</p><pre>Контекст = кв_HTTPСервисы.КонтекстЗапроса(Запрос, <b>Истина</b>, <b>Истина</b>, ПараметрыМетода);</pre>
<p></p></blockquote>
<p> - <b>Контроль конфликтов</b>: Включает проверку HTTP-запросов на конфликты. В случае срабатывания возвращает клиенту ответ с кодом состояния <b>409 Conflict</b>, блокируя выполнение повторного HTTP-запроса до завершения обработки первичного, или до момента его разблокировки;</p>
<p> - <b>Повторов до разблокировки конфликтов</b>: Определяет количество заблокированных повторных HTTP-запросов, при достижении которого выполняется автоматическое их разблокирование, путем добавления маркера разблокирования в блокирующую запись первичного запроса в регистре сведений <a href="InformationRegister.кв_ЖурналВходящихHTTPЗапросов/Help">"Журнал входящих HTTP-запросов"</a>. Автоматическое разблокирование выполняется регламентным заданием "Разблокирование конфликтов HTTP-запросов". Также из формы записи регистра сведений <a href="InformationRegister.кв_ЖурналКонфликтовHTTPЗапросов/Help">"Журнал конфликтов HTTP-запросов"</a> можно выполнить ручное разблокирование HTTP-запроса;</p>
<p> - <b>Порог разблокировки конфликтов</b>: Определяет количество заблокированных уникальных первичных HTTP-запросов с момента последнего выполнения регламентного задания "Разблокирование конфликтов HTTP-запросов". Значение, при достижении которого разблокирование временно перестает выполняться, до момента восстановления допустимых значений. Эта настройка предотвращает преждевременное разблокирование запросов в случае масштабного сбоя. Опираясь на значение этого показателя, разблокирование возобновляется, когда сбой устранен и количество свежих блокировок становится меньше порогового значения;</p>
<p> - <b>Период проверки порога разблокировки</b>: Определяет интервал времени в минутах, за который вычисляется количество заблокированных уникальных первичных HTTP-запросов и выполняется контроль достижения порога разблокировки. Этот параметр тесно связан с предыдущим;</p>
<p> - <b>Период гарантированной разблокировки</b>: Устанавливает время в минутах, прошедшее с момента блокировки HTTP-запроса, после которого выполняется его гарантированная разблокировка регламентным заданием "Разблокирование конфликтов HTTP-запросов";</p>
<p> - <b>Максимальная длина тела запроса</b>: Устанавливает количество символов, больше которой строка тела входящего HTTP-запроса в регистре сведений <a href="InformationRegister.кв_ЖурналВходящихHTTPЗапросов/Help">"Журнал входящих HTTP-запросов"</a> обрезается. 0 - без ограничений.</p>


</body></html>